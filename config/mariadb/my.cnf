# TWLan 2.A3 - MariaDB 10.11 Configuration
# Optimized for game server workload
# Last Updated: November 10, 2025 (Pass 2 Optimization)

[client]
port                    = 3306
socket                  = /var/run/mysqld/mysqld.sock
default-character-set   = utf8mb4

[mysqld]
# Basic Settings
user                    = mysql
pid-file                = /var/run/mysqld/mysqld.pid
socket                  = /var/run/mysqld/mysqld.sock
port                    = 3306
basedir                 = /usr
datadir                 = /var/lib/mysql
tmpdir                  = /tmp
lc-messages-dir         = /usr/share/mysql
skip-external-locking

# Character Set & Collation
character-set-server    = utf8mb4
collation-server        = utf8mb4_unicode_ci

# Networking
bind-address            = 0.0.0.0
max_connections         = 200
max_connect_errors      = 1000
connect_timeout         = 10
wait_timeout            = 600
interactive_timeout     = 600
# Connection pooling
thread_cache_size       = 16
max_allowed_packet      = 64M

# Query Cache - DEPRECATED in MariaDB 10.11+
# Modern versions use InnoDB buffer pool instead
query_cache_type        = 0
query_cache_size        = 0
# Note: Query cache removed in MariaDB 10.11 - relying on InnoDB optimization

# InnoDB Settings (optimized for game data)
innodb_buffer_pool_size         = 256M
innodb_log_file_size            = 64M
innodb_log_buffer_size          = 16M
innodb_flush_log_at_trx_commit  = 2
innodb_file_per_table           = 1
innodb_flush_method             = O_DIRECT
innodb_io_capacity              = 200
innodb_io_capacity_max          = 400
innodb_read_io_threads          = 4
innodb_write_io_threads         = 4

# MyISAM Settings (for session/cache tables)
key_buffer_size         = 32M
myisam_sort_buffer_size = 8M
myisam_max_sort_file_size = 10G
myisam_repair_threads   = 1

# Buffer Settings
sort_buffer_size        = 2M
read_buffer_size        = 1M
read_rnd_buffer_size    = 8M
join_buffer_size        = 2M
table_open_cache        = 400
table_definition_cache  = 400
thread_cache_size       = 8
tmp_table_size          = 32M
max_heap_table_size     = 32M

# Logging
log_error               = /var/log/mysql/error.log
slow_query_log          = 1
slow_query_log_file     = /var/log/mysql/slow.log
long_query_time         = 2
log_queries_not_using_indexes = 0

# Binary Logging (for replication/backup)
log_bin                 = /var/log/mysql/mysql-bin.log
expire_logs_days        = 7
max_binlog_size         = 100M
binlog_format           = ROW

# Safety
max_allowed_packet      = 64M
sql_mode                = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION

[mysqldump]
quick
quote-names
max_allowed_packet      = 64M

[mysql]
default-character-set   = utf8mb4

[isamchk]
key_buffer_size         = 16M
